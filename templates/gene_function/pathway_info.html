{% extends "gene_function/gene_function.html" %}

{% block title %}<title>Pathway Info</title>{% endblock %}
{% block custom_style %}

{% endblock %}

{% block content %}
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>

    <h2 style="text-align: center; font-size: 1.6em;" >Pathway Info</h2>
    <div class="row">
        <div class="col-1">
        </div>
        <div class="col-10">
            <div class="table_padding">
                <div class="card vh-25" id="speciesCard">
                    <div class="card-body text-left row">
                        <div class="col-3">
                            <p style="font-size: 0.9rem"><b>Pathway:</b><br />{{ pathway_id }}</p>
                        </div>
                        <div class="col-3">
                            <p style="font-size: 0.9rem"><b>Name:</b><br />{{ pathway_name }}</p>
                        </div>
                        <div class="col-3">
                            <p style="font-size: 0.9rem"><b>Map:</b><br /><a href="{{ pathway_kegg_link }}" target="_blank">KEGG</a></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="table_padding">
                <table id="pathway_info" class="table table-hover" style="width:100%; table-layout: fixed;">
                    <thead>
                    <tr>
                        <th>Gene</th>
                        <th>Species</th>
                        <th>Family</th>
                        <th>Product</th>
                        <th>Class</th>
                        <th>KEGG Orthology</th>
                    </tr>
                    </thead>
                    <tbody id="table-body"></tbody>
                </table>
            </div>
        </div>
        <div class="col-1">
        </div>
    </div>

    <script>
        $(document).ready(async function () {
            const geneData = {{ dataGenes|safe }}
    
            let table = $('#pathway_info').DataTable({
                responsive: true,
                lengthChange: false,
                paging: true,
                destroy: true,
                order: [],   // preserve the original order (needed to order by relevance)
                data: geneData,
                columns: [
                    {
                        data: 'gene',
                        render: function (data, type, row) {
                            return '<a href="{% url 'gene_info' %}?species=' + row["pangenome_analysis"] + '&gene=' + data + '">' + data + '</a>';
                        }
                    },
                    {
                        data: 'species',
                        render: function (data, type, row) {
                            return '<a href="{% url 'pangenome_analyses_overview' %}?species=' + row["pangenome_analysis"] + '">' + data + '</a>';
                        }
                    },
                    {
                        data: 'family',
                        render: function (data, type, row) {
                            return '<a href="{% url 'organisms' %}?family=' + data + '">' + data + '</a>';
                        }
                    },
                    {
                        data: 'protein',
                    },
                    {
                        data: 'pangenomic_class',
                    },
                    {
                        data: 'kegg_ko',
                        render: function(data, type, row) {
                            return data.join(', ') + '&nbsp;&nbsp;<a style="font-size: 0.8em; font-style: italic;" href="' + row["kegg_link"] + '" target="_blank">(highlight)</a>';
                        }
                    }
                ],
                language: {
                    loadingRecords: 'Loading...',
                    zeroRecords: 'No data available in table'
                },
    
                initComplete: function () {
                    var api = this.api();
                    // Existing column search code
                    $(this.api().table().header()).find('th').each(function (index, th) {
                        var columnHeader = $(th);
                        var columnIndex = index;
                        var searchInput = $('<input type="text" class="form-control form-control-sm" placeholder="Search" style="width: 60%; display: block; justify-content: center;" />')
                            .on('keyup change clear', function () {
                                api.column(columnIndex).search(this.value).draw();
                            })
                            .on('click', function(e) {  // Prevent event bubbling on click
                                e.stopPropagation();
                            });
                        $(searchInput).appendTo(columnHeader);
                    });
                }
            });
        });
    </script>

{% endblock %}
