<html>

<head>
	<meta charSet="UTF-8">
	<meta name="description" content="Simple BioJS example"/>

	<!-- include MSA js + css -->
	<script src="./dist/msa_readable.js"></script>
	<script src="//d3js.org/d3.v6.js"></script>

	<style>
		#tooltip {
			position: absolute;
			padding: 10px;
			background: red;
			border-radius: 5px;
			/*visibility: hidden; !* Initially hidden *!*/
			opacity: 0;
			transition: visibility 0s, opacity 0.5s linear; /* This will animate the fade in and out effect */
		}
	</style>
</head>

<body>

<div>some text</div>
<div>more text</div>
<div>of your awesome website</div>
<br>

<!--A simple website with left and right bars-->
<div>
	<div style="width: 100%; display: inline-block">
		<div id="menuDiv"></div>
		<div id="yourDiv" style="position: relative;">Loading ...</div>
		<div id="tooltip" style="position: absolute; opacity: 1; padding: 10px; background: white; border-radius: 5px;">
			Frequency information will go here.
		</div>


		<script>
			//msa = require("msa");
			//msa = window.msa;
			console.log(window.innerWidth );

			var opts = {};

			opts.el = document.getElementById("yourDiv");
			opts.vis = {
				conserv: true,
				overviewbox: true,
				seqlogo: true,
				leftHeader: false,
				labelId: false,
				gapHeader: true,
			};
			opts.conf = {
				dropImport: false,
				registerMouseClicks: true, // make sure to register mouse clicks
				registerMouseHover: true
			};
			opts.zoomer = {
				menuFontsize: "12px",
				autoResize: true,
				boxRectWidth: 10,
				overviewboxWidth: 100,
				overviewboxHeight: 200,
				alignmentHeight: 300,
				markerFontsize: "12px",
				markerStepSize: 2,
				overviewboxPaddingTop: 30,
			};

			// init msa
			var m = new msa(opts);




			function renderMSA() {
				// call render at the end to display the whole MSA
				m.render();

				// Add a click listener on rows
				m.g.on("row:click", function(data) {
					// Get the sequence object
					var sequence = m.seqs.at(data.seqId);

					console.log(data)

					// Get the name of the sequence
					var sequenceName = sequence.get('name');

					// Define a unique URL for each sequence
					var url = "./popup.html?=" + sequenceName;

					// Open a new page
					window.open(url, '_blank');
				});

				m.g.on("column:click", function(data) {
					// Create text to be shown in the panel
					var text = 'Column: ' + data.rowPos;
					console.log(text);
					console.log(data.evt);
					// Show the text in the panel
					var tooltip = document.getElementById('tooltip');
					tooltip.textContent = text;

					var rect = document.getElementById('yourDiv').getBoundingClientRect();

					tooltip.style.left = (data.evt.pageX - rect.left) + 'px';  // position the tooltip at the mouse pointer
					tooltip.style.top = (data.evt.pageY - rect.top) + 'px';
					tooltip.classList.remove('tooltip-hidden');
					tooltip.classList.add('tooltip-showing');
				});

				// And don't forget to handle the mouseout event to hide the panel:
				m.g.on("column:mouseout", function(data) {
					var tooltip = document.getElementById('tooltip');
					tooltip.classList.remove('tooltip-showing');
					tooltip.classList.add('tooltip-hidden');
				});

			}

			var defaultURL = "./fer3.clustal";

			function getURLParameter(name) {
				return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [, ""])[1].replace(/\+/g, '%20')) || null;
			}

			var url = getURLParameter('seq') || defaultURL;
			m.u.file.importURL(url, renderMSA);

		</script>
	</div>
</div>

</body>
</html>
