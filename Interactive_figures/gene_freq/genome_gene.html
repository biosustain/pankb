<!DOCTYPE html>
<html>
<head>
    <style>
        html, body, #container {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/mouse-wheel-zoom.js"></script>
    <script src="https://code.highcharts.com/modules/series-label.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js"></script>
</head>
<body>
<div id="container"></div>

<script>
    function roundToDecimal(number, decimalPlaces) {
        var factor = Math.pow(10, decimalPlaces);
        return Math.round(number * factor) / factor;
    }


    document.addEventListener('DOMContentLoaded', function() {

        fetch('https://pankb.blob.core.windows.net/data/PanKB/web_data/species_genome_gene.json')
            .then(response => response.json())
            .then(data => {
                const organisms = Object.keys(data);
                const series = [];

                const colorList = [
                    'rgb(238,130,238)', // Mycobacteriaceae
                    'rgb(173, 216, 230)', // Streptomycetaceae
                    'rgb(255,127,80)', // Enterobacteriaceae
                    'rgb(102,205,170)',// Bacillaceae
                    'rgba(100,149,237)', // Pseudomonadaceae
                    'rgba(255,215,0)' // Lactobacillaceae
                ];

                organisms.forEach((organism, index) => {
                    const organismData = data[organism];

                    const points = Object.keys(organismData).map(key => {
                        const genomeNumber = organismData[key][0];
                        const geneNumber = organismData[key][1];

                        // Ensure non-zero, positive values for logarithmic scale
                        const xValue = Math.max(genomeNumber, 1);
                        const yValue = Math.max(geneNumber, 1);

                        return {x: xValue, y: yValue, name: key};
                    });

                    const serie = {
                        name: organism,
                        color: colorList[organisms.indexOf(organism)],
                        data: points,

                        marker: {
                            symbol: 'circle',
                            radius: 6,
                            states: {
                                hover: {
                                    enabled: true,
                                    lineColor: 'rgb(100,100,100)',
                                    radiusPlus: 2
                                }
                            }
                        }
                    };

                    series.push(serie);
                });
                const orderedSeriesNames = ['Enterobacteriaceae', 'Lactobacillaceae', 'Bacillaceae', 'Mycobacteriaceae', 'Pseudomonadaceae', 'Streptomycetaceae']; // Specify your desired order
                const orderedSeries = orderedSeriesNames.map(name => series.find(serie => serie.name === name));

                Highcharts.chart('container', {
                    chart: {
                        type: 'scatter',
                        zoomType: 'x',
                        zooming: {
                            mouseWheel: false
                        }
                    },
                    exporting: {
                        enabled: false
                    },
                    title: {
                        text: '',
                        style: {
                            fontSize: '18px'
                        }
                    },
                    xAxis: {
                        title: {
                            text: 'Genomes',
                            style: {
                                fontSize: '18px'
                            }                        },
                        type: 'logarithmic',
                        showLastLabel: true,
                        tickInterval: 1,
                        lineWidth:1,
                        tickWidth: 1,
                        gridLineWidth: 1,
                        crosshair: true,
                        labels:  {
                            style: {
                                fontSize: '16px'
                            }
                        }
                    },
                    yAxis: {
                        title: {
                            text: 'Genes',
                            style: {
                                fontSize: '16px'
                            }
                        },
                        type: 'logarithmic',
                        lineWidth:1,
                        tickInterval: 1,
                        tickWidth: 1,
                        gridLineWidth: 1,
                        crosshair: true,
                        labels:  {
                                style: {
                                    fontSize: '16px'
                            }
                        }
                    },
                    legend: {
                        layout: 'vertical',
                        align: 'left',
                        verticalAlign: 'top',
                        x: 100,
                        itemStyle: {
                            fontSize: '16px',
                        },
                        floating: true,
                        backgroundColor: Highcharts.defaultOptions.chart.backgroundColor,
                        borderWidth: 1
                    },

                    plotOptions: {
                        scatter: {
                            tooltip: {
                                headerFormat: '<b>{point.name}</b><br>',
                                pointFormat: '<b>Species</b>: {point.name}<br><b>Number of genomes</b>: {point.x}<br><b>Number of genes:</b> {point.y}'
                            },
                            point: {
                                events: {
                                    click: function () {
                                        window.open(`../../Pangenome_analyses_overview.html?species=${encodeURIComponent(this.options.name)}`, '_blank');
                                    }
                                }
                            }
                        }
                    },
                    series: orderedSeries,
                    credits: {
                        enabled: false
                    }
                });

                //
                // $('#container').on('mousewheel', function(event) {
                //     event.preventDefault(); // Prevent the default zoom behavior
                //
                //     var chart = $('#container').highcharts();
                //     var yAxis = chart.yAxis[0];
                //
                //     var delta = event.originalEvent.deltaY || event.originalEvent.detail || event.originalEvent.wheelDelta;
                //
                //     // Calculate zoom level based on the delta
                //     // Adjust these values to control zoom speed on a logarithmic scale
                //     var zoomFactor = delta > 0 ? 0.5 : 2;
                //
                //     var newMin = yAxis.min * zoomFactor;
                //     var newMax = yAxis.max * zoomFactor;
                //
                //     // Prevent zooming out beyond max or zooming in beyond min
                //     newMin = Math.max(newMin, yAxis.dataMin);
                //     newMax = Math.min(newMax, yAxis.dataMax);
                //
                //     yAxis.setExtremes(newMin, newMax, false);
                //
                //     chart.redraw();
                // });

            });
    });
</script>
</body>
</html>
